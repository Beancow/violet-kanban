import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{r as o}from"./index-0yr9KlQE.js";import{u as K,a as U,b as H}from"./TempIdMapProvider-Bn-SK8yN.js";import{a as R,e as V,g as y}from"./QueueProvider-khQ-P9eI.js";import{o as T,r as G,a as B,v as $,b as E,y as C,c as Y,s as Z,u as J,e as X,n as ee,t as z,R as te,T as ae,P as ne,d as se,C as re,A as oe}from"./base-button-BIe7Bfhx.js";import{S as D}from"./index-CUsz_pzo.js";import{a as ie}from"./mocks-CWpEX7Zs.js";import"./index-tymuTqDW.js";import"./index-DotmK1FS.js";const ce=["normal","start","end","both"],le={trim:{type:"enum",className:"rt-r-lt",values:ce,responsive:!0}},de=["left","center","right"],ue={align:{type:"enum",className:"rt-r-ta",values:de,responsive:!0}},pe=["wrap","nowrap","pretty","balance"],me={wrap:{type:"enum",className:"rt-r-tw",values:pe,responsive:!0}},fe={truncate:{type:"boolean",className:"rt-truncate"}},ge=["light","regular","medium","bold"],he={weight:{type:"enum",className:"rt-r-weight",values:ge,responsive:!0}},ye=["span","div","label","p"],xe=["1","2","3","4","5","6","7","8","9"],be={as:{type:"enum",values:ye,default:"span"},...B,size:{type:"enum",className:"rt-r-size",values:xe,responsive:!0},...he,...ue,...le,...fe,...me,...G,...T},m=o.forwardRef((t,r)=>{const{children:a,className:n,asChild:i,as:c="span",color:u,...f}=$(t,be,E);return o.createElement(D,{"data-accent-color":u,...f,ref:r,className:C("rt-Text",n)},i?a:o.createElement(c,null,a))});m.displayName="Text";const ve=["1","2","3"],Ce=["solid","soft","surface","outline"],je={...B,size:{type:"enum",className:"rt-r-size",values:ve,default:"1",responsive:!0},variant:{type:"enum",className:"rt-variant",values:Ce,default:"soft"},...Z,...T,...Y},F=o.forwardRef((t,r)=>{const{asChild:a,className:n,color:i,radius:c,...u}=$(t,je,E),f=a?D:"span";return o.createElement(f,{"data-accent-color":i,"data-radius":c,...u,ref:r,className:C("rt-reset","rt-Badge",n)})});F.displayName="Badge";const Ae=["div","span"],Ne=["none","inline","inline-block","block","contents"],we={as:{type:"enum",values:Ae,default:"div"},...B,display:{type:"enum",className:"rt-r-display",values:Ne,responsive:!0}},p=o.forwardRef((t,r)=>{const{className:a,asChild:n,as:i="div",...c}=$(t,we,J,E);return o.createElement(n?X:i,{...c,ref:r,className:C("rt-Box",a)})});p.displayName="Box";const L=o.forwardRef(({className:t,...r},a)=>o.createElement(ee,{...r,ref:a,className:C("rt-IconButton",t)}));L.displayName="IconButton";const Ie={content:{type:"ReactNode",required:!0},width:z.width,minWidth:z.minWidth,maxWidth:{...z.maxWidth,default:"360px"}},M=o.forwardRef((t,r)=>{const{children:a,className:n,open:i,defaultOpen:c,onOpenChange:u,delayDuration:f,disableHoverableContent:j,content:A,container:N,forceMount:x,...w}=$(t,Ie),s={open:i,defaultOpen:c,onOpenChange:u,delayDuration:f,disableHoverableContent:j};return o.createElement(te,{...s},o.createElement(ae,{asChild:!0},a),o.createElement(ne,{container:N,forceMount:x},o.createElement(se,{asChild:!0},o.createElement(re,{sideOffset:4,collisionPadding:10,...w,asChild:!1,ref:r,className:C("rt-TooltipContent",n)},o.createElement(m,{as:"p",className:"rt-TooltipText",size:"1"},A),o.createElement(oe,{className:"rt-TooltipArrow"})))))});M.displayName="Tooltip";function qe(){const t=K(),r=U(),a=H(),n=t.state.boards,i=r.state.lists,c=a.state.cards;return{boards:n,lists:i,cards:c}}function P(){const t=R();return{boardActionQueue:t.state.boardActionQueue,listActionQueue:t.state.listActionQueue,cardActionQueue:t.state.cardActionQueue}}function Qe(t,r){if(t==null)return{};var a={},n=Object.keys(t),i,c;for(c=0;c<n.length;c++)i=n[c],!(r.indexOf(i)>=0)&&(a[i]=t[i]);return a}var $e=["color"],ze=o.forwardRef(function(t,r){var a=t.color,n=a===void 0?"currentColor":a,i=Qe(t,$e);return o.createElement("svg",Object.assign({width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},i,{ref:r}),o.createElement("path",{d:"M7.14645 2.14645C7.34171 1.95118 7.65829 1.95118 7.85355 2.14645L11.8536 6.14645C12.0488 6.34171 12.0488 6.65829 11.8536 6.85355C11.6583 7.04882 11.3417 7.04882 11.1464 6.85355L8 3.70711L8 12.5C8 12.7761 7.77614 13 7.5 13C7.22386 13 7 12.7761 7 12.5L7 3.70711L3.85355 6.85355C3.65829 7.04882 3.34171 7.04882 3.14645 6.85355C2.95118 6.65829 2.95118 6.34171 3.14645 6.14645L7.14645 2.14645Z",fill:n,fillRule:"evenodd",clipRule:"evenodd"}))});const Le="_queueContainer_18f9g_2",Be="_queueList_18f9g_6",Ee="_queueItem_18f9g_12",v={queueContainer:Le,queueList:Be,queueItem:Ee};function W(){const{boardActionQueue:t,listActionQueue:r,cardActionQueue:a}=P(),{boards:n,lists:i,cards:c}=qe(),u=o.useMemo(()=>[...t,...r,...a],[t,r,a]),{removeBoardAction:f,removeListAction:j,removeCardAction:A}=R(),[N,x]=o.useState([]);if(o.useEffect(()=>{x(V(u,n,i,c))},[u,n,i,c]),u.length===0)return e.jsx(m,{children:"No pending actions."});const w=s=>{var I,q,b,l,g,h;switch(s.type){case"create-board":case"update-board":return((I=n.find(d=>d.id===y(s)))==null?void 0:I.title)||"Board";case"delete-board":case"move-board":return((q=n.find(d=>d.id===y(s)))==null?void 0:q.title)||"Board";case"create-list":case"update-list":return((b=i.find(d=>d.id===y(s)))==null?void 0:b.title)||"List";case"delete-list":case"move-list":return((l=i.find(d=>d.id===y(s)))==null?void 0:l.title)||"List";case"create-card":case"update-card":return((g=c.find(d=>d.id===y(s)))==null?void 0:g.title)||"Card";case"delete-card":case"soft-delete-card":case"restore-card":case"move-card":return((h=c.find(d=>d.id===y(s)))==null?void 0:h.title)||"Card";case"create-organization":return s.payload.name||"Organization";case"update-organization":return s.payload.data.name||"Organization";case"delete-organization":return"Organization";case"fetch-org-data":return"Fetch Org Data";case"sync-complete":return"Sync Complete";case"error":return"Error";default:return"Unknown Action"}};return e.jsxs(p,{className:v.queueContainer,children:[N.length>0&&e.jsxs(p,{className:v.conflictContainer,children:[e.jsx(m,{weight:"bold",color:"red",children:"Data conflict detected!"}),e.jsx("ul",{children:N.map(({id:s,local:I,server:q,action:b,type:l})=>e.jsxs("li",{className:v.conflictItem,children:[e.jsxs(m,{children:[l.charAt(0).toUpperCase()+l.slice(1)," ",e.jsx("b",{children:w(b)})," has conflicting changes:"]}),e.jsxs(p,{children:[e.jsxs(m,{size:"1",children:[e.jsx("b",{children:"Local update:"})," ",String(I.updatedAt)," (queued at"," ",b.timestamp,")",e.jsx("br",{}),e.jsx("b",{children:"Server update:"})," ",String(q.updatedAt)]}),e.jsxs(p,{mt:"2",children:[e.jsx("button",{onClick:()=>{x(g=>g.filter(h=>h.id!==s)),l==="board"&&f(s),l==="list"&&j(s),l==="card"&&A(s)},children:"Keep Local"}),e.jsx("button",{onClick:()=>{x(g=>g.filter(h=>h.id!==s)),l==="board"&&f(s),l==="list"&&j(s),l==="card"&&A(s)},style:{marginLeft:8},children:"Keep Server"})]})]})]},s))})]}),e.jsx("ul",{className:v.queueList,children:u.map(s=>e.jsxs("li",{className:v.queueItem,children:[e.jsxs(p,{children:[e.jsx(m,{weight:"bold",children:w(s)}),e.jsx(m,{size:"1",color:"gray",as:"p",children:s.type})]}),e.jsx(m,{size:"1",color:"gray",children:s.timestamp})]},s.timestamp))})]})}W.__docgenInfo={description:"",methods:[],displayName:"ActionQueue"};function S(){const[t,r]=o.useState(!1),{boardActionQueue:a,listActionQueue:n,cardActionQueue:i}=P(),c=[...a,...n,...i];return e.jsxs(e.Fragment,{children:[e.jsx(p,{style:{position:"fixed",bottom:32,right:32,zIndex:1e3},children:e.jsx(M,{content:"Show sync queue",children:e.jsxs(L,{size:"3",variant:"solid",color:"blue",onClick:()=>r(!0),style:{position:"relative"},children:[e.jsx(ze,{}),c.length>0&&e.jsx(F,{color:"red",style:{position:"absolute",top:-8,right:-8,fontSize:12,borderRadius:"50%",padding:"2px 8px"},children:c.length})]})})}),t&&e.jsxs(p,{style:{position:"fixed",top:0,right:0,width:350,height:"100%",backgroundColor:"var(--gray-2)",zIndex:1001,boxShadow:"-2px 0 5px #0000001a",display:"flex",flexDirection:"column",transition:"right .3s ease-in-out"},children:[e.jsxs(p,{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"1rem",borderBottom:"1px solid var(--gray-5)",backgroundColor:"var(--gray-3)"},children:[e.jsx("span",{style:{fontWeight:"bold",fontSize:18},children:"Sync Queue"}),e.jsx(L,{size:"2",variant:"ghost",color:"gray",onClick:()=>r(!1),children:"Ã—"})]}),e.jsx(p,{style:{flexGrow:1,padding:"1rem",overflowY:"auto"},children:e.jsx(W,{})})]})]})}S.__docgenInfo={description:"",methods:[],displayName:"FloatingSyncButton"};const Pe={title:"Components/FloatingSyncButton",component:S},Q={render:()=>{const t=ie(),r=t.state.boardActionQueue.concat(t.state.listActionQueue,t.state.cardActionQueue);return r.find(a=>{var n;return((n=a.payload)==null?void 0:n.tempId)==="temp-1"})||t.enqueueBoardAction({type:"create-board",payload:{tempId:"temp-1",data:{title:"Board 1",organizationId:"org-1"}}}),r.find(a=>{var n;return((n=a.payload)==null?void 0:n.tempId)==="temp-2"})||t.enqueueListAction({type:"create-list",payload:{tempId:"temp-2",data:{title:"List 1",position:0,boardId:"",organizationId:"org-1"}}}),e.jsx(S,{})}};var _,k,O;Q.parameters={...Q.parameters,docs:{...(_=Q.parameters)==null?void 0:_.docs,source:{originalSource:`{
  render: () => {
    // populate mock queue for the story idempotently
    const q = useMockQueue();
    const existing = q.state.boardActionQueue.concat(q.state.listActionQueue, q.state.cardActionQueue);
    if (!existing.find((a: any) => a.payload?.tempId === 'temp-1')) {
      q.enqueueBoardAction({
        type: 'create-board',
        payload: {
          tempId: 'temp-1',
          data: {
            title: 'Board 1',
            organizationId: 'org-1'
          } as any
        }
      } as any);
    }
    if (!existing.find((a: any) => a.payload?.tempId === 'temp-2')) {
      q.enqueueListAction({
        type: 'create-list',
        payload: {
          tempId: 'temp-2',
          data: {
            title: 'List 1',
            position: 0,
            boardId: '',
            organizationId: 'org-1'
          } as any
        }
      } as any);
    }
    return <FloatingSyncButton />;
  }
}`,...(O=(k=Q.parameters)==null?void 0:k.docs)==null?void 0:O.source}}};const We=["Default"];export{Q as Default,We as __namedExportsOrder,Pe as default};
